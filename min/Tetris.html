<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>俄罗斯方块</title><style>*{margin:0;padding:0}.left{float:left}.right{float:right}.clear-fixed:after{content:"";display:table;clear:both}.container{width:400px;height:650px;position:absolute;top:20px;left:50%;margin-left:-200px}.container .header{width:100%;height:50px;font-size:25px}.container .header .score-panel,.container .header .title{height:50px;text-align:center;line-height:50px}#game-over{display:none;position:absolute;left:50%;top:50px;width:400px;height:600px;border-radius:10px;background-color:rgba(0,0,0,.6);margin-left:-200px;text-align:center;z-index:5}#game-over .panel{position:absolute;left:50%;right:50%;top:200px;width:220px;height:200px;border-radius:10px;background-color:#fff;margin-left:-110px;text-align:center;z-index:6}#again{display:inline-block;width:170px;height:50px;border-radius:10px;text-decoration:none;background-color:#9f8d77;color:#fff;font-size:36px}</style></head><body><div class=container><div class="header clear-fixed"><div class="title left">俄罗斯方块</div><div class="score-panel right"><span>得分: </span><span id=score>0</span></div></div><canvas id=canvas width=400 height=600></canvas><div id=game-over><div class=panel><h1 id=state style=margin-top:5px></h1><a href=javascript:; id=again>再试一次</a></div></div><div>TIP: 通过键盘 ← → 键操作左右移动，按 ↓ 键加速下落，按space键变形</div></div><script>var blockL=[[[0,0,1],[1,1,1]],[[1,0],[1,0],[1,1]],[[1,1,1],[1,0,0]],[[1,1],[0,1],[0,1]]],blockJ=[[[1,0,0],[1,1,1]],[[1,1],[1,0],[1,0]],[[1,1,1],[0,0,1]],[[0,1],[0,1],[1,1]]],blockI=[[[1,1,1,1]],[[1],[1],[1],[1]],[[1,1,1,1]],[[1],[1],[1],[1]]],blockO=[[[1,1],[1,1]],[[1,1],[1,1]],[[1,1],[1,1]],[[1,1],[1,1]]],blockZ=[[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]],[[1,1,0],[0,1,1]],[[0,1],[1,1],[1,0]]],blockS=[[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]],[[0,1,1],[1,1,0]],[[1,0],[1,1],[0,1]]],blockT=[[[1,1,1],[0,1,0]],[[0,1],[1,1],[0,1]],[[0,1,0],[1,1,1]],[[1,0],[1,1],[1,0]]],ROWS=30,COLS=20,BLOCK_SIZE=20;</script><script>function deepCopyMatrix(r){var e=[];return r.map((function(r){r instanceof Array?e.push(deepCopyMatrix(r)):e.push(r)})),e}function mergeMatrix(r,e,t){var n=r.row,o=r.col,a=r.arr;t=t||!1;for(var u=deepCopyMatrix(e),i=0;i<a.length;i++)if(u[n+i]&&u[n+i]instanceof Array)for(var c=0;c<4;c++){var f=u[n+i][o+c],p=a[i][c];(t||o+c>=0&&p)&&(u[n+i][o+c]=1===f?1:p)}return u}function generatorMatrix(){for(var r=[],e=0;e<ROWS;e++){for(var t=[],n=0;n<COLS;n++)t.push(0);r.push(t)}return r}function $(r){return/^#\S+/.test(r)?document.querySelector(r):document.querySelectorAll(r)}</script><script>!function(t){var r=function(t){this.x=COLS/2,this.y=0,this.roates=t||blockL,this.dir=0,this.data=this.roates[this.dir]};r.prototype={rotate:function(t){var r=this.dir;r++,r%=4;var i={row:this.y,col:this.x-2,arr:this.roates[r]},e=mergeMatrix(i,deepCopyMatrix(t),!0);for(var n in e)if(e[n].length>COLS||e[n][-1]!==undefined)return;this.dir++,this.dir=this.dir%4,this.data=this.roates[this.dir]},isContactBorder:function(t,r){for(var i=0;i<t.length;i++)if("left"===r){if(1===t[i][0])return!0}else if("right"===r&&1===t[i][COLS-1])return!0;return!1},checkMatrix:function(t,r){var i=r.x,e=r.y;return 1===t[i][e]},Collision:function(t,r,i){for(var e=r.row,n=r.col,o=r.arr,a=0;a<o.length;a++)for(var s=0;s<o[a].length;s++)if(1===o[a][s]){var c={x:a+e,y:s+n};if("right"!==i&&"left"!==i||(c.y=s+n+("right"===i?1:-1)),this.checkMatrix(t,c))return!0}return!1},move:function(t,r){var i={row:this.y,col:this.x-2,arr:this.data},e=mergeMatrix(i,generatorMatrix());this.isContactBorder(e,t>0?"right":"left")||this.Collision(r,i,t>0?"right":"left")||(this.x+=t)},down:function(){this.y++}};var i={blockTypes:["L","J","I","O","Z","S","T"],create:function(t){switch(t){case"L":default:return new r(blockL);case"J":return new r(blockJ);case"I":return new r(blockI);case"O":return new r(blockO);case"Z":return new r(blockZ);case"S":return new r(blockS);case"T":return new r(blockT)}},rand:function(){return this.create(this.blockTypes[~~(Math.random()*this.blockTypes.length)])}};t.Block=r,t.BlockFactory=i}(window);</script><script>!function(t,r){var e=function(t){this.canvas=$(t||"#canvas"),this.ctx=this.canvas.getContext("2d"),this.rows=ROWS,this.cols=COLS,this.latticeSize=BLOCK_SIZE,this.canvas.width=BLOCK_SIZE*this.cols,this.canvas.height=BLOCK_SIZE*this.rows,this.addEvent(),this.init()};e.prototype={init:function(){this.matrix=generatorMatrix(),this.timer=null,this.currentBlock=null,this.blockFactory=BlockFactory,this.score=0,this.isOver=!1,$("#score").innerText=this.score},draw:function(){var t=this.matrix,r=this.ctx,e=this.canvas,i=this.latticeSize;r.clearRect(0,0,e.width,e.height);var n=deepCopyMatrix(t);if(this.currentBlock){var s=this.currentBlock.x,a=this.currentBlock.y,o=this.currentBlock.data;n=mergeMatrix({row:a,col:s-2,arr:o},n)}for(var c=0;c<n.length;c++)for(var h=n[c],l=0;l<h.length;l++){var u=h[l];r.fillStyle=0===u?"#eee":"#2196f3",r.fillRect(i*l+1,c*i+1,i-2,i-2)}},generatorBlock:function(){this.currentBlock=this.blockFactory.rand(),this.fastMoveDown(!1)},fullLine:function(){for(var t=0;t<this.matrix.length;t++)if(-1===this.matrix[t].indexOf(0)){this.matrix.splice(t,1);for(var r=[],e=0;e<this.cols;e++)r.push(0);this.matrix.unshift(r),this.updateScore()}},checkMerge:function(){var t=this.currentBlock.x,r=this.currentBlock.y,e=this.currentBlock.data,i=deepCopyMatrix(this.matrix);if(r+e.length===i.length)return!0;for(var n=0;n<e.length;n++)for(var s=r+n,a=0;a<i[s].length;a++)if(1===e[n][a-t+2]&&1===i[s+1][a])return!0;return!1},merge:function(){var t=this.currentBlock.x,r={row:this.currentBlock.y,col:t-2,arr:this.currentBlock.data};this.matrix=mergeMatrix(r,this.matrix),this.fullLine()},fastMoveDown:function(t){this.fast=t,clearInterval(this.timer);var r=this;this.timer=t?setInterval((function(){r.runtime()}),10):setInterval((function(){r.runtime()}),500)},addEvent:function(){var t=this;r.addEventListener("keyup",(function(r){if(t.isOver)return!1;32===r.keyCode&&(t.currentBlock.rotate(t.matrix),t.draw()),40===r.keyCode&&t.fastMoveDown(!1)})),r.addEventListener("keydown",(function(r){if(t.isOver)return!1;!1===t.fast&&40===r.keyCode&&t.fastMoveDown(!0),37===r.keyCode&&(t.currentBlock.move(-1,t.matrix),t.draw()),39===r.keyCode&&(t.currentBlock.move(1,t.matrix),t.draw())}))},start:function(){this.generatorBlock(),this.draw(),this.runtime(),this.fastMoveDown(!1)},runtime:function(){this.draw(),!1===this.isGameOver()?this.checkMerge()?(this.merge(),this.generatorBlock()):this.currentBlock.down():(clearInterval(this.timer),this.isOver=!0,$("#state").innerHTML="游戏结束<br>得分:<br>"+this.score,$("#state").style.color="red",$("#game-over").style.display="block")},isGameOver:function(){return-1!==this.matrix[0].indexOf(1)},updateScore:function(){this.score+=10,$("#score").innerText=this.score}};var i=new e;i.start(),$("#again").addEventListener("click",(function(){$("#game-over").style.display="none",i.init(),i.start()})),t.Game=e}(window,document);</script></body></html>