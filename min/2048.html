<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>2048小游戏</title><style>*{margin:0;padding:0}.left{float:left}.right{float:right}.clear-fixed:after{content:"";display:table;clear:both}.container{width:480px;height:530px;position:absolute;top:20px;left:50%;margin-left:-240px}.container .header{width:100%;height:50px;font-size:25px}.container .header .score-panel{height:50px;text-align:center;line-height:50px}#canvas{width:480px;height:480px;background-color:#bbada0;border-radius:10px}#game-over{display:none;position:absolute;left:50%;top:50px;width:480px;height:480px;border-radius:10px;background-color:rgba(0,0,0,.6);margin-left:-240px;text-align:center;z-index:5}#game-over .panel{position:absolute;left:50%;right:50%;top:140px;width:220px;height:200px;border-radius:10px;background-color:#fff;margin-left:-110px;text-align:center;z-index:6}#again{display:inline-block;width:170px;height:50px;border-radius:10px;text-decoration:none;background-color:#9f8d77;color:#fff;font-size:36px}</style></head><body><div class=container><div class="header clear-fixed"><div class="score-panel left"><span>得分: </span><span id=score>0</span></div><div class="selection right"><label for=mode>模式选择</label> <select id=mode><option value=3>3 X 3</option><option value=4 selected="">4 X 4</option><option value=5>5 X 5</option><option value=6>6 X 6</option></select></div></div><canvas id=canvas width=480 height=480></canvas><div id=game-over><div class=panel><h1 id=state style=margin-top:5px></h1><a href=javascript:; id=again>再试一次</a></div></div><div>TIP: 通过键盘↑ ↓ ← → 键操作</div></div><script>!function(i,s){i.$=function(i){return/^#\S+/.test(i)?s.querySelector(i):s.querySelectorAll(i)},i.Game=function(i){this.canvas=$(i),this.ctx=this.canvas.getContext("2d"),this.mapWidth=this.canvas.width,this.mapHeight=this.canvas.height},Game.prototype={score:0,isWin:!1,isOver:!1,cols:4,rows:4,spacing:15,grids:[],bgColors:{0:"#ccc0b3",2:"#eee3da",4:"#ede0c8",8:"#f2b179",16:"#f59563",32:"#f67c5f",64:"#f65e3b",128:"#edcf72",256:"#edcc61",512:"#9c0",1024:"#33b5e5",2048:"#09c",4096:"#a6c",8192:"#93c"},init:function(){this.score=0,this.isWin=!1,this.isOver=!1,this.width=(this.mapWidth-(this.cols+1)*this.spacing)/this.cols,this.height=(this.mapHeight-(this.rows+1)*this.spacing)/this.rows;for(var i=0;i<this.rows;i++){this.grids[i]=[];for(var s=0;s<this.cols;s++){var t=s*this.width+this.spacing*(s+1),r=i*this.height+this.spacing*(i+1);this.grids[i][s]={num:0,x:t,y:r}}}this.random(),this.random(),this.draw(),this.updateScore()},start:function(){var i=this;i.init(),s.onkeydown=function(s){if(this.isWin||this.isOver)return!1;switch(s.keyCode){case 37:i.dir=3,i.moveLeft();break;case 38:i.dir=1,i.moveUp();break;case 39:i.dir=4,i.moveRight();break;case 40:i.dir=2,i.moveDown()}i.updateScore()}},random:function(){for(;;){var i=Math.floor(Math.random()*this.rows),s=Math.floor(Math.random()*this.cols);if(0===this.grids[i][s].num){this.grids[i][s].num=Math.random()>=.6?4:2;break}}},updateScore:function(){$("#score").innerText=this.score},isGameOver:function(){for(var i=0;i<this.rows;i++)for(var s=0;s<this.cols;s++){if(0===this.grids[i][s].num)return!1;if(s!=this.cols-1&&this.grids[i][s].num===this.grids[i][s+1].num)return!1;if(i!=this.rows-1&&this.grids[i][s].num===this.grids[i+1][s].num)return!1}return!0},find:function(i,s,t,r){if(1===this.dir){for(var n=t;n<r;n+=1)if(0!=this.grids[n][s].num)return n}else if(2===this.dir){for(n=t;n>=r;n+=-1)if(0!=this.grids[n][s].num)return n}else if(3===this.dir){for(n=t;n<r;n+=1)if(0!=this.grids[i][n].num)return n}else if(4===this.dir)for(n=t;n>=r;n+=-1)if(0!=this.grids[i][n].num)return n;return null},move:function(i){var s;s=this.gridsToString(this.grids),i(),s!=this.gridsToString(this.grids)&&(this.random(),this.draw())},moveLeft:function(){var i=this;this.move((function(){for(var s=0;s<i.rows;s++)for(var t,r=0;r<i.cols&&null!=(t=i.find(s,r,r+1,i.cols));r++)0===i.grids[s][r].num?(i.grids[s][r].num=i.grids[s][t].num,i.grids[s][t].num=0,r--):i.grids[s][r].num===i.grids[s][t].num&&(i.grids[s][r].num*=2,i.grids[s][t].num=0,i.score+=i.grids[s][r].num)}))},moveRight:function(){var i=this;this.move((function(){for(var s=0;s<i.rows;s++)for(var t,r=i.cols-1;r>=0&&null!=(t=i.find(s,r,r-1,0));r--)0===i.grids[s][r].num?(i.grids[s][r].num=i.grids[s][t].num,i.grids[s][t].num=0,r++):i.grids[s][r].num===i.grids[s][t].num&&(i.grids[s][r].num*=2,i.grids[s][t].num=0,i.score+=i.grids[s][r].num)}))},moveUp:function(){var i=this;this.move((function(){for(var s=0;s<i.cols;s++)for(var t,r=0;r<i.rows&&null!=(t=i.find(r,s,r+1,i.rows));r++)0===i.grids[r][s].num?(i.grids[r][s].num=i.grids[t][s].num,i.grids[t][s].num=0,r--):i.grids[r][s].num==i.grids[t][s].num&&(i.grids[r][s].num*=2,i.grids[t][s].num=0,i.score+=i.grids[r][s].num)}))},moveDown:function(){var i=this;this.move((function(){for(var s=0;s<i.cols;s++)for(var t,r=i.rows-1;r>=0&&null!=(t=i.find(r,s,r-1,0));r--)0===i.grids[r][s].num?(i.grids[r][s].num=i.grids[t][s].num,i.grids[t][s].num=0,r++):i.grids[r][s].num===i.grids[t][s].num&&(i.grids[r][s].num*=2,i.grids[t][s].num=0,i.score+=i.grids[r][s].num)}))},draw:function(){this.ctx.clearRect(0,0,this.mapWidth,this.mapHeight);for(var i=0;i<this.rows;i++)for(var s=0;s<this.cols;s++){var t=this.grids[i][s].x,r=this.grids[i][s].y,n=this.grids[i][s].num,e=this.bgColors[n];this.fillRoundRect(this.ctx,t,r,this.width,this.height,10,e),n>0&&this.fillText(this.ctx,n,t+this.width/2,r+this.height/2,this.width-20,n<=4?"#776e65":"#fff"),3===this.rows&&1024===n&&(this.isWin=!0),4===this.rows&&2048===n&&(this.isWin=!0),5===this.rows&&4096===n&&(this.isWin=!0),6===this.rows&&8192===n&&(this.isWin=!0)}this.isWin&&($("#state").innerHTML="YOU WIN<br>SCORE:<br>"+this.score,$("#state").style.color="green",$("#game-over").style.display="block"),this.isGameOver()&&(this.isOver=!0,$("#state").innerHTML="游戏结束<br>得分:<br>"+this.score,$("#state").style.color="red",$("#game-over").style.display="block")},fillText:function(i,s,t,r,n,e){i.fillStyle=e||"#000",i.font="bold 40px '微软雅黑'",i.textAlign="center",i.textBaseline="middle",i.fillText(s,t,r,n)},fillRoundRect:function(i,s,t,r,n,e,o){if(2*e>r||2*e>n)return!1;i.save(),i.translate(s,t),this.drawRoundRectPath(i,r,n,e),i.fillStyle=o||"#000",i.fill(),i.restore()},drawRoundRectPath:function(i,s,t,r){i.beginPath(0),i.arc(s-r,t-r,r,0,Math.PI/2),i.lineTo(r,t),i.arc(r,t-r,r,Math.PI/2,Math.PI),i.lineTo(0,r),i.arc(r,r,r,Math.PI,3*Math.PI/2),i.lineTo(s-r,0),i.arc(s-r,r,r,3*Math.PI/2,2*Math.PI),i.lineTo(s,t-r),i.closePath()},gridsToString:function(i){var s="[";for(var t in i)"[object Array]"===Object.prototype.toString.call(i[t])?s+=this.gridsToString(i[t]):"[object Object]"===Object.prototype.toString.call(i[t])?s+=JSON.stringify(i[t]):s+=i[t];return s+="]"}}}(window,document);var game=new Game("#canvas");game.start(),$("#mode").onchange=function(){game.rows=game.cols=$("#mode").value/1,game.init(),$("#mode").blur()},$("#again").onclick=function(){$("#game-over").style.display="none",game.init()};</script></body></html>